#!/usr/bin/env bash

bash -euo pipefail
source script/lib/blob-store.sh

bucket_name="zed-nightly-host"

sha=$(git rev-parse HEAD)
echo ${sha} > ./release-artifacts/latest-sha

for file_to_upload in ./release-artifacts/*; do
    [ -f "$file_to_upload" ] || continue
    upload_to_blob_store $bucket_name "$file_to_upload" "nightly/$(basename "$file_to_upload")"
    upload_to_blob_store $bucket_name "$file_to_upload" "${GITHUB_SHA}/$(basename "$file_to_upload")"
    rm -f "$file_to_upload"
done
