# Generated from xtask::workflows::publish_extension_cli
# Rebuild with `cargo xtask workflows`.
name: publish_extension_cli
env:
  CARGO_TERM_COLOR: always
  CARGO_INCREMENTAL: '0'
on:
  push:
    tags:
    - extension-cli
jobs:
  publish_job:
    if: (github.repository_owner == 'zed-industries' || github.repository_owner == 'zed-extensions')
    runs-on: namespace-profile-2x4-ubuntu-2404
    steps:
    - name: steps::checkout_repo
      uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683
      with:
        clean: false
    - name: steps::cache_rust_dependencies_namespace
      uses: namespacelabs/nscloud-cache-action@v1
      with:
        cache: rust
        path: ~/.rustup
    - name: steps::setup_linux
      run: ./script/linux
      shell: bash -euxo pipefail {0}
    - name: publish_extension_cli::publish_job::build_extension_cli
      run: cargo build --release --package extension_cli
      shell: bash -euxo pipefail {0}
    - name: publish_extension_cli::publish_job::upload_binary
      run: script/upload-extension-cli ${{ github.sha }}
      shell: bash -euxo pipefail {0}
      env:
        DIGITALOCEAN_SPACES_ACCESS_KEY: ${{ secrets.DIGITALOCEAN_SPACES_ACCESS_KEY }}
        DIGITALOCEAN_SPACES_SECRET_KEY: ${{ secrets.DIGITALOCEAN_SPACES_SECRET_KEY }}
